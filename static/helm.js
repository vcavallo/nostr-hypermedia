// HelmJS v0.6.0 - https://github.com/Letdown2491/helmjs
var O=new Map,j=new WeakMap,y=t=>j.get(t)||(j.set(t,{}),j.get(t)),E=t=>document.querySelector(t),v=(t,e)=>t.hasAttribute(e),X=(t,e)=>{for(let n of t)n.tagName==="A"?(n.classList.toggle("h-disabled",e),e?n.setAttribute("aria-disabled","true"):n.removeAttribute("aria-disabled")):e?n.setAttribute("disabled",""):n.removeAttribute("disabled")},p=(t,e,n={})=>t.dispatchEvent(new CustomEvent(`h:${e}`,{detail:n,bubbles:!0,cancelable:!0})),ot=(t,e)=>{e==="top"?window.scrollTo({top:0,behavior:"smooth"}):e==="bottom"?window.scrollTo({top:document.body.scrollHeight,behavior:"smooth"}):(e==="target"?t:E(e))?.scrollIntoView({behavior:"smooth",block:"start"})},f=(t,e,n="")=>t.getAttribute(e)??n,V=(t,e)=>{let n=new DOMParser().parseFromString(t,"text/html").querySelector(e);return n?n.innerHTML:t},I=t=>!!t.closest("[h-ignore]"),G=t=>t instanceof HTMLInputElement||t instanceof HTMLTextAreaElement,F=t=>t?{"H-Request":"true","H-Target":t}:{"H-Request":"true"},J=t=>{let e=t.match(/<title[^>]*>([\s\S]*?)<\/title>/i);return e&&(document.title=e[1].trim()),t.replace(/<title[^>]*>[\s\S]*?<\/title>/gi,"")},it=t=>{let e=t.trim().split(/\s+/),n=new Map;for(let s=1;s<e.length;s++){let[r,d]=e[s].split(":");n.set(r,d??"true")}return{event:e[0],mods:n}},at=(t,e)=>{let n;return s=>{clearTimeout(n),n=setTimeout(()=>t(s),e)}},ct=(t,e)=>{let n=0;return s=>{let r=Date.now();r-n>=e&&(n=r,t(s))}},_=t=>{if(!t)return 0;let e=t.match(/^(\d+)(ms|s|m)?$/);return e?e[2]==="ms"?+e[1]:e[2]==="m"?+e[1]*6e4:+e[1]*1e3:0},D=t=>{if(!t.includes("h-oob"))return t;let e=document.createElement("template");e.innerHTML=t;for(let n of e.content.querySelectorAll("[h-oob]")){let s=n.getAttribute("h-oob")||"true";n.removeAttribute("h-oob");let r=n.id?document.getElementById(n.id):null;if(r)if(s==="value"&&G(r))r.value=n.getAttribute("value")??n.textContent??"";else if(s==="replace"&&G(r)){let d=n.getAttribute("data-find")??"",o=n.getAttribute("data-replace")??"";if(d)if(n.hasAttribute("data-all"))r.value=r.value.split(d).join(o);else if(n.hasAttribute("data-first"))r.value=r.value.replace(d,o);else{let a=r.value.lastIndexOf(d);a>=0&&(r.value=r.value.slice(0,a)+o+r.value.slice(a+d.length))}}else if(s==="merge"&&G(r))try{r.value=JSON.stringify({...JSON.parse(r.value||"{}"),...JSON.parse(n.getAttribute("value")??n.textContent??"{}")})}catch{}else M(r,n.outerHTML,s==="true"?"outer":s);n.remove()}return e.innerHTML},M=(t,e,n)=>{n==="inner"?t.innerHTML=e:n==="outer"?t.outerHTML=e:n==="before"?t.insertAdjacentHTML("beforebegin",e):n==="after"?t.insertAdjacentHTML("afterend",e):n==="prepend"?t.insertAdjacentHTML("afterbegin",e):n==="append"?t.insertAdjacentHTML("beforeend",e):n==="morph"&&lt(t,e)},lt=(t,e)=>{let n=document.createElement("template");n.innerHTML=e.trim(),tt(t,n.content)},tt=(t,e)=>{let n=[...t.childNodes],s=[...e.childNodes],r=n.filter(l=>l.nodeType===1),d=s.filter(l=>l.nodeType===1),o=l=>l.some(u=>u.nodeType===3&&u.textContent?.trim());if(o(n)||o(s)){t instanceof Element&&(t.innerHTML=e instanceof Element?e.innerHTML:e.children[0]?.outerHTML||"");return}let a=new Map;for(let l of r)l.id&&a.set(l.id,l);let i=new Set,c=0;for(let l of d){let u;l.id&&a.has(l.id)?u=a.get(l.id):c<r.length&&r[c].tagName===l.tagName&&!r[c].id&&!i.has(r[c])&&(u=r[c]);let g=t.children[c]||null;u?(i.add(u),g!==u&&t.insertBefore(u,g),ut(u,l)):t.insertBefore(l.cloneNode(!0),g),c++}for(let l of r)i.has(l)||l.remove()},ut=(t,e)=>{if(t.tagName!==e.tagName){t.replaceWith(e.cloneNode(!0));return}let n=t instanceof HTMLInputElement,s=t instanceof HTMLTextAreaElement;for(let{name:r}of t.attributes)e.hasAttribute(r)||t.removeAttribute(r);for(let{name:r,value:d}of e.attributes)(n||s)&&r==="value"||t.getAttribute(r)!==d&&t.setAttribute(r,d);if(n&&e instanceof HTMLInputElement){let r=e.getAttribute("value");r&&t.value!==r&&(t.value=r),t.checked!==e.checked&&(t.checked=e.checked);return}if(s&&e instanceof HTMLTextAreaElement){let r=e.textContent;r&&t.value!==r&&(t.value=r);return}if(!e.children.length&&!t.children.length){t.textContent!==e.textContent&&(t.textContent=e.textContent);return}tt(t,e)},et=t=>{let e=t.tagName;if(v(t,"h-get")){let n=t.getAttribute(e==="A"?"href":e==="FORM"?"action":"");return n?{method:"GET",action:n}:null}if(e==="FORM"){let n=t.getAttribute("action");if(!n)return null;for(let s of["post","put","patch","delete"])if(v(t,`h-${s}`))return{method:s.toUpperCase(),action:n}}return null},ft=t=>{if(y(t).init||I(t))return;let e=et(t);if(!e||!p(t,"init",{}))return;let n=t.tagName==="FORM"?"submit":"click",s=f(t,"h-trigger",n).split(",").map(o=>o.trim()).filter(Boolean),r=f(t,"h-sync"),d=async o=>{let a=f(t,"h-confirm");if(a&&!confirm(a))return;let i=y(t);if(r==="abort"&&i.abort)i.abort.abort();else if(r==="drop"&&i.abort)return;let c=r?new AbortController:void 0;c&&(i.abort=c);let l=t instanceof HTMLFormElement?t:null,u=l?new FormData(l):null;l&&o instanceof SubmitEvent&&o.submitter?.hasAttribute("name")&&u.append(o.submitter.getAttribute("name"),o.submitter.value);let g=f(t,"h-include");if(g){u||(u=new FormData);for(let h of document.querySelectorAll(g))(h instanceof HTMLInputElement||h instanceof HTMLTextAreaElement||h instanceof HTMLSelectElement)&&h.name&&u.append(h.name,h.value)}let A=f(t,"h-target"),C=A?E(A)??t:t,R=f(t,"h-swap","morph"),H=f(t,"h-headers"),k=F(A);if(H)try{k={...k,...JSON.parse(H)}}catch{}let q=e.method==="GET",m={trigger:o,action:e.action,method:e.method,target:C,swap:R,body:q||e.method==="DELETE"?null:u,headers:k};if(o.preventDefault(),!p(t,"before",{cfg:m}))return;let nt=!q,rt=v(t,"h-no-disable"),L=[];(nt&&!rt||v(t,"h-disabled"))&&(t.tagName==="FORM"?L.push(...t.querySelectorAll('button, input[type="submit"]')):L.push(t));let U=f(t,"h-disabled");U&&L.push(...document.querySelectorAll(U)),X(L,!0);let W=f(t,"h-indicator"),x=W?E(W):null;x&&x.classList.add("h-loading");let w=m.action;if(u&&m.method==="GET"){let h=new URLSearchParams(u);h.toString()&&(w+=(w.includes("?")?"&":"?")+h)}try{let h,b,P=q?O.get(w):null;if(P&&P.expires>Date.now()){let{response:S,text:T}=await P.promise;h=S,b=J(T),O.delete(w)}else h=await fetch(w,{method:m.method,headers:m.headers,body:m.body,signal:c?.signal}),b=J(await h.text());let B=f(t,"h-select");if(B&&(b=V(b,B)),h.status>=400){let S=f(t,"h-error-target"),T=S?E(S):null;T&&M(T,b,"inner"),p(t,"error",{cfg:m,response:h,html:b})}else if(p(t,"after",{cfg:m,response:h,html:b})){b=D(b);let S=f(t,"h-scroll"),T=S==="target"?m.target:null,z=()=>M(m.target,b,m.swap);if(document.startViewTransition?await document.startViewTransition(z).finished:z(),p(t,"swapped",{cfg:m,response:h,html:b}),document.contains(t)||p(document.documentElement,"swapped",{cfg:m,response:h,html:b}),S)if(S==="target"&&m.swap==="outer"){let N=T?.id?document.getElementById(T.id):null;N&&N.scrollIntoView({behavior:"smooth",block:"start"})}else ot(m.target,S);let K=f(t,"h-focus");K&&E(K)?.focus?.();let Q=v(t,"h-push-url"),st=v(t,"h-replace-url");if(Q||st){let N={h:!0,url:w,target:A||null,swap:m.swap,select:B||null,title:document.title};Q?history.pushState(N,"",w):history.replaceState(N,"",w)}}}catch(h){if(h.name==="AbortError")return;p(t,"error",{cfg:m,error:h})}finally{c&&(i.abort=void 0),X(L,!1),x&&x.classList.remove("h-loading")}};for(let o of s){let{event:a,mods:i}=it(o),c=d;i.has("debounce")&&(c=at(c,parseInt(i.get("debounce"))||300)),i.has("throttle")&&(c=ct(c,parseInt(i.get("throttle"))||300));let l=i.get("from"),u=l?E(l):t;if(a==="intersect"){let g=parseFloat(i.get("threshold")??"0"),A=i.get("rootMargin")??"0px",C=new IntersectionObserver(R=>{for(let H of R)H.isIntersecting&&(c(new CustomEvent("intersect",{detail:H})),i.has("once")&&C.disconnect())},{threshold:g,rootMargin:A});C.observe(t)}else u&&u.addEventListener(a,c,{once:i.has("once"),capture:i.has("capture"),passive:i.has("passive")})}y(t).init=!0,p(t,"inited",{})},dt=t=>{if(y(t).sse||I(t))return;let e=f(t,"h-sse");if(!e)return;let n=new Map;t.querySelectorAll("template[h-sse-on]").forEach(o=>{let a=f(o,"h-sse-on"),i=f(o,"h-target");a&&i&&n.set(a,{target:i,swap:f(o,"h-swap","append")})});let s=f(t,"h-target"),r=f(t,"h-swap","append"),d=new EventSource(e);y(t).sse=d,p(t,"sse-connect",{url:e}),n.forEach((o,a)=>{d.addEventListener(a,i=>{let c=E(o.target);c&&(M(c,D(i.data),o.swap),p(t,"sse-message",{event:a,data:i.data}))})}),d.onmessage=o=>{if(s){let a=E(s);a&&(M(a,D(o.data),r),p(t,"sse-message",{data:o.data}))}},d.onerror=()=>p(t,"sse-error",{url:e})},ht=t=>{if(y(t).poll||I(t))return;let e=f(t,"h-poll");if(!e)return;let n=e.trim().split(/\s+/),s=n[0],r=_(n[1])||3e4,d=f(t,"h-swap","inner"),o=f(t,"h-target"),a=f(t,"h-select"),c=setInterval(async()=>{if(!document.contains(t)){clearInterval(c);return}let l=o?E(o)??t:t;try{let u=await fetch(s,{headers:F(o)});if(u.ok){let g=await u.text();a&&(g=V(g,a)),g=D(g),M(l,g,d),p(t,"poll",{url:s,html:g})}}catch{}},r);y(t).poll=c,p(t,"poll-start",{url:s,interval:r})},mt=t=>{if(t.tagName!=="A"||!v(t,"h-get")||I(t))return;let e=t.getAttribute("href");if(!e)return;let s=f(t,"h-prefetch","hover").trim().split(/\s+/),r=s[0]||"hover",d=_(s[1])||3e4,o=()=>{let a=O.get(e);if(a&&a.expires>Date.now())return;let i=F(f(t,"h-target")),c=f(t,"h-headers");if(c)try{i={...i,...JSON.parse(c)}}catch{}let l=fetch(e,{headers:i}).then(async u=>({response:u,text:await u.text()}));O.set(e,{promise:l,expires:Date.now()+d})};if(r==="intersect"){let a=new IntersectionObserver(i=>{for(let c of i)c.isIntersecting&&(o(),a.disconnect())});a.observe(t)}else t.addEventListener("mouseenter",o,{once:!0}),t.addEventListener("focus",o,{once:!0})},Y=t=>{et(t)&&ft(t),v(t,"h-sse")&&dt(t),v(t,"h-poll")&&ht(t),v(t,"h-prefetch")&&mt(t)},$=t=>{!(t instanceof Element)||I(t)||(Y(t),t.querySelectorAll("a[h-get][href], form[h-get][action], form[h-post][action], form[h-put][action], form[h-patch][action], form[h-delete][action], [h-sse], [h-poll], [h-prefetch]").forEach(Y))},gt=new MutationObserver(t=>{for(let e of t)e.addedNodes.forEach($)}),Z=()=>{gt.observe(document.documentElement,{childList:!0,subtree:!0}),$(document.body)};document.readyState==="loading"?document.addEventListener("DOMContentLoaded",Z):Z();document.addEventListener("h:process",t=>$(t.target));history.replaceState({h:!0,url:location.href,target:null,swap:"morph",select:null,title:document.title},"");window.addEventListener("popstate",async t=>{let e=t.state;if(!e?.h)return;if(e.title&&(document.title=e.title),!e.target){location.reload();return}let n=E(e.target);if(!n){location.reload();return}try{let s=J(await(await fetch(e.url,{headers:F(e.target)})).text());e.select&&(s=V(s,e.select)),M(n,s,e.swap)}catch{location.reload()}});

